\hypertarget{motor_8h_source}{}\doxysection{motor.\+h}
\label{motor_8h_source}\index{shared/libraries/motor.h@{shared/libraries/motor.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/****************************************************************************}}
\DoxyCodeLine{2 \textcolor{comment}{ *                                                                          *}}
\DoxyCodeLine{3 \textcolor{comment}{ *  Copyright (C) 2022 RoboMaster.                                          *}}
\DoxyCodeLine{4 \textcolor{comment}{ *  Illini RoboMaster @ University of Illinois at Urbana-\/Champaign          *}}
\DoxyCodeLine{5 \textcolor{comment}{ *                                                                          *}}
\DoxyCodeLine{6 \textcolor{comment}{ *  This program is free software: you can redistribute it and/or modify    *}}
\DoxyCodeLine{7 \textcolor{comment}{ *  it under the terms of the GNU General Public License as published by    *}}
\DoxyCodeLine{8 \textcolor{comment}{ *  the Free Software Foundation, either version 3 of the License, or       *}}
\DoxyCodeLine{9 \textcolor{comment}{ *  (at your option) any later version.                                     *}}
\DoxyCodeLine{10 \textcolor{comment}{ *                                                                          *}}
\DoxyCodeLine{11 \textcolor{comment}{ *  This program is distributed in the hope that it will be useful,         *}}
\DoxyCodeLine{12 \textcolor{comment}{ *  but WITHOUT ANY WARRANTY; without even the implied warranty of          *}}
\DoxyCodeLine{13 \textcolor{comment}{ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the           *}}
\DoxyCodeLine{14 \textcolor{comment}{ *  GNU General Public License for more details.                            *}}
\DoxyCodeLine{15 \textcolor{comment}{ *                                                                          *}}
\DoxyCodeLine{16 \textcolor{comment}{ *  You should have received a copy of the GNU General Public License       *}}
\DoxyCodeLine{17 \textcolor{comment}{ *  along with this program. If not, see <http://www.gnu.org/licenses/>.    *}}
\DoxyCodeLine{18 \textcolor{comment}{ *                                                                          *}}
\DoxyCodeLine{19 \textcolor{comment}{ ****************************************************************************/}}
\DoxyCodeLine{20 }
\DoxyCodeLine{21 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{22 }
\DoxyCodeLine{23 \textcolor{preprocessor}{\#include "{}bsp\_can.h"{}}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#include "{}bsp\_pwm.h"{}}}
\DoxyCodeLine{25 \textcolor{preprocessor}{\#include "{}controller.h"{}}}
\DoxyCodeLine{26 \textcolor{preprocessor}{\#include "{}utils.h"{}}}
\DoxyCodeLine{27 }
\DoxyCodeLine{28 \textcolor{keyword}{namespace }control \{}
\DoxyCodeLine{29 }
\DoxyCodeLine{33 \textcolor{keyword}{class }\mbox{\hyperlink{classcontrol_1_1MotorBase}{MotorBase}} \{}
\DoxyCodeLine{34  \textcolor{keyword}{public}:}
\DoxyCodeLine{35   \mbox{\hyperlink{classcontrol_1_1MotorBase}{MotorBase}}() : output\_(0) \{\}}
\DoxyCodeLine{36   \textcolor{keyword}{virtual} \mbox{\hyperlink{classcontrol_1_1MotorBase}{\string~MotorBase}}() \{\}}
\DoxyCodeLine{37 }
\DoxyCodeLine{38   \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} SetOutput(int16\_t val) \{ output\_ = val; \}}
\DoxyCodeLine{39 }
\DoxyCodeLine{40  \textcolor{keyword}{protected}:}
\DoxyCodeLine{41   int16\_t output\_;}
\DoxyCodeLine{42 \};}
\DoxyCodeLine{43 }
\DoxyCodeLine{47 \textcolor{keyword}{class }\mbox{\hyperlink{classcontrol_1_1MotorCANBase}{MotorCANBase}} : \textcolor{keyword}{public} \mbox{\hyperlink{classcontrol_1_1MotorBase}{MotorBase}} \{}
\DoxyCodeLine{48  \textcolor{keyword}{public}:}
\DoxyCodeLine{55   \mbox{\hyperlink{classcontrol_1_1MotorCANBase_abafacd8a1556c0f072af837050f73154}{MotorCANBase}}(\mbox{\hyperlink{classbsp_1_1CAN}{bsp::CAN}}* can, uint16\_t rx\_id);}
\DoxyCodeLine{56 }
\DoxyCodeLine{63   \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{classcontrol_1_1MotorCANBase_ab2e2ed5b79cbaeb4b3eb1bdb76afd891}{UpdateData}}(\textcolor{keyword}{const} uint8\_t data[]) = 0;}
\DoxyCodeLine{64 }
\DoxyCodeLine{68   \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{classcontrol_1_1MotorCANBase_af814cf537fdbc0e26ff1de78066e5d92}{PrintData}}() \textcolor{keyword}{const} = 0;}
\DoxyCodeLine{69 }
\DoxyCodeLine{75   \textcolor{keyword}{virtual} \textcolor{keywordtype}{float} \mbox{\hyperlink{classcontrol_1_1MotorCANBase_adc4ba7b1769874e06ca3d37b7a158bbe}{GetTheta}}() \textcolor{keyword}{const};}
\DoxyCodeLine{76 }
\DoxyCodeLine{84   \textcolor{keyword}{virtual} \textcolor{keywordtype}{float} \mbox{\hyperlink{classcontrol_1_1MotorCANBase_ae9f95c4c2ac5cce454d72a72550f40c1}{GetThetaDelta}}(\textcolor{keyword}{const} \textcolor{keywordtype}{float} target) \textcolor{keyword}{const};}
\DoxyCodeLine{85 }
\DoxyCodeLine{91   \textcolor{keyword}{virtual} \textcolor{keywordtype}{float} \mbox{\hyperlink{classcontrol_1_1MotorCANBase_a5f8ad4dfe15633b942240a10bae4e026}{GetOmega}}() \textcolor{keyword}{const};}
\DoxyCodeLine{92 }
\DoxyCodeLine{100   \textcolor{keyword}{virtual} \textcolor{keywordtype}{float} \mbox{\hyperlink{classcontrol_1_1MotorCANBase_a1eb827b95597b6d0ac9a04b906264d09}{GetOmegaDelta}}(\textcolor{keyword}{const} \textcolor{keywordtype}{float} target) \textcolor{keyword}{const};}
\DoxyCodeLine{101 }
\DoxyCodeLine{108   \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{classcontrol_1_1MotorCANBase_a855c72f421341aba3a48923e1ff9b3bb}{TransmitOutput}}(\mbox{\hyperlink{classcontrol_1_1MotorCANBase}{MotorCANBase}}* motors[], uint8\_t num\_motors);}
\DoxyCodeLine{109 }
\DoxyCodeLine{114   \textcolor{keyword}{friend} \textcolor{keyword}{class }\mbox{\hyperlink{classcontrol_1_1ServoMotor}{ServoMotor}};}
\DoxyCodeLine{115 }
\DoxyCodeLine{116  \textcolor{keyword}{protected}:}
\DoxyCodeLine{117   \textcolor{keyword}{volatile} \textcolor{keywordtype}{float} theta\_;}
\DoxyCodeLine{118   \textcolor{keyword}{volatile} \textcolor{keywordtype}{float} omega\_;}
\DoxyCodeLine{119 }
\DoxyCodeLine{120  \textcolor{keyword}{private}:}
\DoxyCodeLine{121   \mbox{\hyperlink{classbsp_1_1CAN}{bsp::CAN}}* can\_;}
\DoxyCodeLine{122   uint16\_t rx\_id\_;}
\DoxyCodeLine{123   uint16\_t tx\_id\_;}
\DoxyCodeLine{124 \};}
\DoxyCodeLine{125 }
\DoxyCodeLine{129 \textcolor{keyword}{class }\mbox{\hyperlink{classcontrol_1_1Motor2006}{Motor2006}} : \textcolor{keyword}{public} \mbox{\hyperlink{classcontrol_1_1MotorCANBase}{MotorCANBase}} \{}
\DoxyCodeLine{130  \textcolor{keyword}{public}:}
\DoxyCodeLine{131   \textcolor{comment}{/* constructor wrapper over MotorCANBase */}}
\DoxyCodeLine{132   \mbox{\hyperlink{classcontrol_1_1Motor2006}{Motor2006}}(\mbox{\hyperlink{classbsp_1_1CAN}{bsp::CAN}}* can, uint16\_t rx\_id);}
\DoxyCodeLine{133   \textcolor{comment}{/* implements data update callback */}}
\DoxyCodeLine{134   \textcolor{keywordtype}{void} \mbox{\hyperlink{classcontrol_1_1Motor2006_a150134c41fc1208c37351d81d36ae2c6}{UpdateData}}(\textcolor{keyword}{const} uint8\_t data[]) \textcolor{keyword}{override} \textcolor{keyword}{final};}
\DoxyCodeLine{135   \textcolor{comment}{/* implements data printout */}}
\DoxyCodeLine{136   \textcolor{keywordtype}{void} \mbox{\hyperlink{classcontrol_1_1Motor2006_a7c45aeee729f67990bd4b046599000d7}{PrintData}}() \textcolor{keyword}{const} \textcolor{keyword}{override} \textcolor{keyword}{final};}
\DoxyCodeLine{137   \textcolor{comment}{/* override base implementation with max current protection */}}
\DoxyCodeLine{138   \textcolor{keywordtype}{void} SetOutput(int16\_t val) \textcolor{keyword}{override} \textcolor{keyword}{final};}
\DoxyCodeLine{139 }
\DoxyCodeLine{140  \textcolor{keyword}{private}:}
\DoxyCodeLine{141   \textcolor{keyword}{volatile} int16\_t raw\_current\_get\_ = 0;}
\DoxyCodeLine{142 \};}
\DoxyCodeLine{143 }
\DoxyCodeLine{147 \textcolor{keyword}{class }\mbox{\hyperlink{classcontrol_1_1Motor3508}{Motor3508}} : \textcolor{keyword}{public} \mbox{\hyperlink{classcontrol_1_1MotorCANBase}{MotorCANBase}} \{}
\DoxyCodeLine{148  \textcolor{keyword}{public}:}
\DoxyCodeLine{149   \textcolor{comment}{/* constructor wrapper over MotorCANBase */}}
\DoxyCodeLine{150   \mbox{\hyperlink{classcontrol_1_1Motor3508}{Motor3508}}(\mbox{\hyperlink{classbsp_1_1CAN}{bsp::CAN}}* can, uint16\_t rx\_id);}
\DoxyCodeLine{151   \textcolor{comment}{/* implements data update callback */}}
\DoxyCodeLine{152   \textcolor{keywordtype}{void} \mbox{\hyperlink{classcontrol_1_1Motor3508_acbb0db8989d65425f4f8d4a85fb8bdc1}{UpdateData}}(\textcolor{keyword}{const} uint8\_t data[]) \textcolor{keyword}{override} \textcolor{keyword}{final};}
\DoxyCodeLine{153   \textcolor{comment}{/* implements data printout */}}
\DoxyCodeLine{154   \textcolor{keywordtype}{void} \mbox{\hyperlink{classcontrol_1_1Motor3508_af6e97b73b11ab50bff4a8dd3eca5f53c}{PrintData}}() \textcolor{keyword}{const} \textcolor{keyword}{override} \textcolor{keyword}{final};}
\DoxyCodeLine{155   \textcolor{comment}{/* override base implementation with max current protection */}}
\DoxyCodeLine{156   \textcolor{keywordtype}{void} SetOutput(int16\_t val) \textcolor{keyword}{override} \textcolor{keyword}{final};}
\DoxyCodeLine{157 }
\DoxyCodeLine{158  \textcolor{keyword}{private}:}
\DoxyCodeLine{159   \textcolor{keyword}{volatile} int16\_t raw\_current\_get\_ = 0;}
\DoxyCodeLine{160   \textcolor{keyword}{volatile} uint8\_t raw\_temperature\_ = 0;}
\DoxyCodeLine{161 \};}
\DoxyCodeLine{162 }
\DoxyCodeLine{166 \textcolor{keyword}{class }\mbox{\hyperlink{classcontrol_1_1Motor6020}{Motor6020}} : \textcolor{keyword}{public} \mbox{\hyperlink{classcontrol_1_1MotorCANBase}{MotorCANBase}} \{}
\DoxyCodeLine{167  \textcolor{keyword}{public}:}
\DoxyCodeLine{168   \textcolor{comment}{/* constructor wrapper over MotorCANBase */}}
\DoxyCodeLine{169   \mbox{\hyperlink{classcontrol_1_1Motor6020}{Motor6020}}(\mbox{\hyperlink{classbsp_1_1CAN}{bsp::CAN}}* can, uint16\_t rx\_id);}
\DoxyCodeLine{170   \textcolor{comment}{/* implements data update callback */}}
\DoxyCodeLine{171   \textcolor{keywordtype}{void} \mbox{\hyperlink{classcontrol_1_1Motor6020_ab815b7b3621a292808a39876c2eca84f}{UpdateData}}(\textcolor{keyword}{const} uint8\_t data[]) \textcolor{keyword}{override} \textcolor{keyword}{final};}
\DoxyCodeLine{172   \textcolor{comment}{/* implements data printout */}}
\DoxyCodeLine{173   \textcolor{keywordtype}{void} \mbox{\hyperlink{classcontrol_1_1Motor6020_aaa6338c02a6e731d2c38e33f3c9b5092}{PrintData}}() \textcolor{keyword}{const} \textcolor{keyword}{override} \textcolor{keyword}{final};}
\DoxyCodeLine{174   \textcolor{comment}{/* override base implementation with max current protection */}}
\DoxyCodeLine{175   \textcolor{keywordtype}{void} SetOutput(int16\_t val) \textcolor{keyword}{override} \textcolor{keyword}{final};}
\DoxyCodeLine{176 }
\DoxyCodeLine{177  \textcolor{keyword}{private}:}
\DoxyCodeLine{178   \textcolor{keyword}{volatile} int16\_t raw\_current\_get\_ = 0;}
\DoxyCodeLine{179   \textcolor{keyword}{volatile} int16\_t raw\_current\_set\_ = 0;}
\DoxyCodeLine{180   \textcolor{keyword}{volatile} uint8\_t raw\_temperature\_ = 0;}
\DoxyCodeLine{181 }
\DoxyCodeLine{182   \textcolor{keyword}{static} \textcolor{keyword}{const} int16\_t CURRENT\_CORRECTION = -\/1;  \textcolor{comment}{// current direction is reversed}}
\DoxyCodeLine{183 \};}
\DoxyCodeLine{184 }
\DoxyCodeLine{188 \textcolor{keyword}{class }\mbox{\hyperlink{classcontrol_1_1Motor6623}{Motor6623}} : \textcolor{keyword}{public} \mbox{\hyperlink{classcontrol_1_1MotorCANBase}{MotorCANBase}} \{}
\DoxyCodeLine{189  \textcolor{keyword}{public}:}
\DoxyCodeLine{190   \textcolor{comment}{/* constructor wrapper over MotorCANBase */}}
\DoxyCodeLine{191   \mbox{\hyperlink{classcontrol_1_1Motor6623}{Motor6623}}(\mbox{\hyperlink{classbsp_1_1CAN}{bsp::CAN}}* can, uint16\_t rx\_id);}
\DoxyCodeLine{192   \textcolor{comment}{/* implements data update callback */}}
\DoxyCodeLine{193   \textcolor{keywordtype}{void} \mbox{\hyperlink{classcontrol_1_1Motor6623_a6de742c94990b8bd799fcdfe5b533fb6}{UpdateData}}(\textcolor{keyword}{const} uint8\_t data[]) \textcolor{keyword}{override} \textcolor{keyword}{final};}
\DoxyCodeLine{194   \textcolor{comment}{/* implements data printout */}}
\DoxyCodeLine{195   \textcolor{keywordtype}{void} \mbox{\hyperlink{classcontrol_1_1Motor6623_a3465c571ff93af1736dad3a561921b75}{PrintData}}() \textcolor{keyword}{const} \textcolor{keyword}{override} \textcolor{keyword}{final};}
\DoxyCodeLine{196   \textcolor{comment}{/* override base implementation with max current protection */}}
\DoxyCodeLine{197   \textcolor{keywordtype}{void} SetOutput(int16\_t val) \textcolor{keyword}{override} \textcolor{keyword}{final};}
\DoxyCodeLine{198   \textcolor{comment}{/* override default implementation with not implemented */}}
\DoxyCodeLine{199   \textcolor{keywordtype}{float} \mbox{\hyperlink{classcontrol_1_1Motor6623_afb43a32f6dfa8f4ae2d6a324defff7be}{GetOmega}}() \textcolor{keyword}{const} \textcolor{keyword}{override} \textcolor{keyword}{final};}
\DoxyCodeLine{200   \textcolor{keywordtype}{float} \mbox{\hyperlink{classcontrol_1_1Motor6623_a5bbe1a28a1e73534333132bb551dd729}{GetOmegaDelta}}(\textcolor{keyword}{const} \textcolor{keywordtype}{float} target) \textcolor{keyword}{const} \textcolor{keyword}{override} \textcolor{keyword}{final};}
\DoxyCodeLine{201 }
\DoxyCodeLine{202  \textcolor{keyword}{private}:}
\DoxyCodeLine{203   \textcolor{keyword}{volatile} int16\_t raw\_current\_get\_ = 0;}
\DoxyCodeLine{204   \textcolor{keyword}{volatile} int16\_t raw\_current\_set\_ = 0;}
\DoxyCodeLine{205 }
\DoxyCodeLine{206   \textcolor{keyword}{static} \textcolor{keyword}{const} int16\_t CURRENT\_CORRECTION = -\/1;  \textcolor{comment}{// current direction is reversed}}
\DoxyCodeLine{207 \};}
\DoxyCodeLine{208 }
\DoxyCodeLine{212 \textcolor{keyword}{class }\mbox{\hyperlink{classcontrol_1_1MotorPWMBase}{MotorPWMBase}} : \textcolor{keyword}{public} \mbox{\hyperlink{classcontrol_1_1MotorBase}{MotorBase}} \{}
\DoxyCodeLine{213  \textcolor{keyword}{public}:}
\DoxyCodeLine{225   \mbox{\hyperlink{classcontrol_1_1MotorPWMBase_a2a0a5c549536ca58cbb29e8c2e5ee648}{MotorPWMBase}}(TIM\_HandleTypeDef* htim, uint8\_t channel, uint32\_t clock\_freq, uint32\_t output\_freq,}
\DoxyCodeLine{226                uint32\_t idle\_throttle);}
\DoxyCodeLine{227 }
\DoxyCodeLine{233   \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{classcontrol_1_1MotorPWMBase_a1cc3990a829a41ebd8241679e3baf56b}{SetOutput}}(int16\_t val) \textcolor{keyword}{override};}
\DoxyCodeLine{234 }
\DoxyCodeLine{235  \textcolor{keyword}{private}:}
\DoxyCodeLine{236   \mbox{\hyperlink{classbsp_1_1PWM}{bsp::PWM}} pwm\_;}
\DoxyCodeLine{237   uint32\_t idle\_throttle\_;}
\DoxyCodeLine{238 \};}
\DoxyCodeLine{239 }
\DoxyCodeLine{243 \textcolor{keyword}{class }\mbox{\hyperlink{classcontrol_1_1Motor2305}{Motor2305}} : \textcolor{keyword}{public} \mbox{\hyperlink{classcontrol_1_1MotorPWMBase}{MotorPWMBase}} \{}
\DoxyCodeLine{244  \textcolor{keyword}{public}:}
\DoxyCodeLine{245   \textcolor{comment}{/* override base implementation with max current protection */}}
\DoxyCodeLine{246   \textcolor{keywordtype}{void} \mbox{\hyperlink{classcontrol_1_1Motor2305_a344f1dffe10ce0b2fe77e3c58d539366}{SetOutput}}(int16\_t val) \textcolor{keyword}{override} \textcolor{keyword}{final};}
\DoxyCodeLine{247 \};}
\DoxyCodeLine{248 }
\DoxyCodeLine{254 \textcolor{keyword}{typedef} \textcolor{keyword}{enum} \{}
\DoxyCodeLine{255   SERVO\_CLOCKWISE       = -\/1,   \textcolor{comment}{/* Servomotor always turn clockwisely                      */}}
\DoxyCodeLine{256   SERVO\_NEAREST         =  0,   \textcolor{comment}{/* Servomotor turn in direction that make movement minimum */}}
\DoxyCodeLine{257   SERVO\_ANTICLOCKWISE   =  1    \textcolor{comment}{/* Servomotor always turn anticlockwisely                  */}}
\DoxyCodeLine{258 \} servo\_mode\_t;}
\DoxyCodeLine{259 }
\DoxyCodeLine{265 \textcolor{keyword}{typedef} \textcolor{keyword}{enum} \{}
\DoxyCodeLine{266   TURNING\_CLOCKWISE     = -\/1,   \textcolor{comment}{/* Servomotor is turning clockwisely         */}}
\DoxyCodeLine{267   INPUT\_REJECT          =  0,   \textcolor{comment}{/* Servomotor rejecting current target input */}}
\DoxyCodeLine{268   TURNING\_ANTICLOCKWISE =  1    \textcolor{comment}{/* Servomotor is turning anticlockwisely     */}}
\DoxyCodeLine{269 \} servo\_status\_t;}
\DoxyCodeLine{270 }
\DoxyCodeLine{274 \textcolor{preprocessor}{\#define M3508P19\_RATIO (3591.0 / 187) }\textcolor{comment}{/* Transmission ratio of M3508P19 */}\textcolor{preprocessor}{}}
\DoxyCodeLine{275 \textcolor{preprocessor}{\#define M2006P36\_RATIO 36             }\textcolor{comment}{/* Transmission ratio of M2006P36 */}\textcolor{preprocessor}{}}
\DoxyCodeLine{276 }
\DoxyCodeLine{277 }
\DoxyCodeLine{278 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{279   servo\_mode\_t mode;  \textcolor{comment}{/* turning mode of servomotor, refer to type servo\_mode\_t                */}}
\DoxyCodeLine{280   servo\_status\_t dir; \textcolor{comment}{/* current turning direction of servomotor, refer to type servo\_status\_t */}}
\DoxyCodeLine{281   \textcolor{keywordtype}{float} speed;        \textcolor{comment}{/* motor shaft turning speed                                             */}  }
\DoxyCodeLine{282 \} \mbox{\hyperlink{structcontrol_1_1servo__jam__t}{servo\_jam\_t}};}
\DoxyCodeLine{283 }
\DoxyCodeLine{284 \textcolor{keyword}{class }\mbox{\hyperlink{classcontrol_1_1ServoMotor}{ServoMotor}}; \textcolor{comment}{// declare first for jam\_callback\_t to have correct param type}}
\DoxyCodeLine{288 \textcolor{comment}{}\textcolor{keyword}{typedef} void (*jam\_callback\_t)(\mbox{\hyperlink{classcontrol_1_1ServoMotor}{ServoMotor}}* servo, \textcolor{keyword}{const} \mbox{\hyperlink{structcontrol_1_1servo__jam__t}{servo\_jam\_t}} data);}
\DoxyCodeLine{289 }
\DoxyCodeLine{293 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{294   \mbox{\hyperlink{classcontrol_1_1MotorCANBase}{MotorCANBase}}* motor;      \textcolor{comment}{/* motor instance to be wrapped as a servomotor     */}}
\DoxyCodeLine{295   servo\_mode\_t mode;        \textcolor{comment}{/* mode of turning, refer to type servo\_mode\_t      */}}
\DoxyCodeLine{296   \textcolor{keywordtype}{float} speed;              \textcolor{comment}{/* desired turning speed of motor shaft, in [rad/s] */}}
\DoxyCodeLine{297   \textcolor{keywordtype}{float} transmission\_ratio; \textcolor{comment}{/* transmission ratio of motor                      */}}
\DoxyCodeLine{298   \textcolor{keywordtype}{float} move\_Kp;            \textcolor{comment}{/* Kp of pid that used to control omega             */}}
\DoxyCodeLine{299   \textcolor{keywordtype}{float} move\_Ki;            \textcolor{comment}{/* Ki of pid that used to control omega             */}}
\DoxyCodeLine{300   \textcolor{keywordtype}{float} move\_Kd;            \textcolor{comment}{/* Kd of pid that used to control omega             */}}
\DoxyCodeLine{301   \textcolor{keywordtype}{float} hold\_Kp;            \textcolor{comment}{/* Kp of pid that used to control theta             */}}
\DoxyCodeLine{302   \textcolor{keywordtype}{float} hold\_Ki;            \textcolor{comment}{/* Ki of pid that used to control theta             */}}
\DoxyCodeLine{303   \textcolor{keywordtype}{float} hold\_Kd;            \textcolor{comment}{/* Kd of pid that used to control theta             */}}
\DoxyCodeLine{304 \} \mbox{\hyperlink{structcontrol_1_1servo__t}{servo\_t}};}
\DoxyCodeLine{305 }
\DoxyCodeLine{312 \textcolor{keyword}{class }\mbox{\hyperlink{classcontrol_1_1ServoMotor}{ServoMotor}} \{}
\DoxyCodeLine{313  \textcolor{keyword}{public}:}
\DoxyCodeLine{320   \mbox{\hyperlink{classcontrol_1_1ServoMotor_a736a9ee40a378c0f0b714ab1544a1de0}{ServoMotor}}(\mbox{\hyperlink{structcontrol_1_1servo__t}{servo\_t}} servo, \textcolor{keywordtype}{float} proximity = 0.05);}
\DoxyCodeLine{321 }
\DoxyCodeLine{330   servo\_status\_t \mbox{\hyperlink{classcontrol_1_1ServoMotor_a8816253f442fabd9ec2af3873e8f0372}{SetTarget}}(\textcolor{keyword}{const} \textcolor{keywordtype}{float} target, \textcolor{keywordtype}{bool} \textcolor{keyword}{override} = \textcolor{keyword}{false});}
\DoxyCodeLine{331 }
\DoxyCodeLine{341   servo\_status\_t \mbox{\hyperlink{classcontrol_1_1ServoMotor_a8816253f442fabd9ec2af3873e8f0372}{SetTarget}}(\textcolor{keyword}{const} \textcolor{keywordtype}{float} target, \textcolor{keyword}{const} servo\_mode\_t mode, \textcolor{keywordtype}{bool} \textcolor{keyword}{override} = \textcolor{keyword}{false});}
\DoxyCodeLine{342 }
\DoxyCodeLine{349   \textcolor{keywordtype}{void} \mbox{\hyperlink{classcontrol_1_1ServoMotor_aef3f0f32dfc4fca3d1c8c68ba2706f84}{SetSpeed}}(\textcolor{keyword}{const} \textcolor{keywordtype}{float} speed);}
\DoxyCodeLine{350 }
\DoxyCodeLine{355   \textcolor{keywordtype}{void} \mbox{\hyperlink{classcontrol_1_1ServoMotor_a50cef52187514938743ec0ce0331bbcb}{CalcOutput}}();}
\DoxyCodeLine{356 }
\DoxyCodeLine{363   \textcolor{keywordtype}{bool} \mbox{\hyperlink{classcontrol_1_1ServoMotor_ae2e2246e02510eab6d567e1891866791}{Holding}}() \textcolor{keyword}{const};}
\DoxyCodeLine{364 }
\DoxyCodeLine{370   \textcolor{keywordtype}{float} \mbox{\hyperlink{classcontrol_1_1ServoMotor_a2fb7226011f25b56752d16a352ab7122}{GetTarget}}() \textcolor{keyword}{const};}
\DoxyCodeLine{371 }
\DoxyCodeLine{386   \textcolor{keywordtype}{void} \mbox{\hyperlink{classcontrol_1_1ServoMotor_aa23d0cec8d18633aa2d5f09ab0e66d97}{RegisterJamCallback}}(jam\_callback\_t callback, \textcolor{keywordtype}{float} effort\_threshold, uint8\_t detect\_period = 50);}
\DoxyCodeLine{387 }
\DoxyCodeLine{391   \textcolor{keywordtype}{void} \mbox{\hyperlink{classcontrol_1_1ServoMotor_a6a7ed43abf57b635007052c407ed8675}{PrintData}}() \textcolor{keyword}{const};}
\DoxyCodeLine{392 }
\DoxyCodeLine{398   \textcolor{keywordtype}{float} \mbox{\hyperlink{classcontrol_1_1ServoMotor_a9cf673e64e68a6a6ba5961bed76da345}{GetTheta}}() \textcolor{keyword}{const};}
\DoxyCodeLine{399 }
\DoxyCodeLine{407   \textcolor{keywordtype}{float} \mbox{\hyperlink{classcontrol_1_1ServoMotor_afc2db2da18b05b4aa1ade9de551522a8}{GetThetaDelta}}(\textcolor{keyword}{const} \textcolor{keywordtype}{float} target) \textcolor{keyword}{const};}
\DoxyCodeLine{408 }
\DoxyCodeLine{414   \textcolor{keywordtype}{float} \mbox{\hyperlink{classcontrol_1_1ServoMotor_a7540691d653b6f56bb0fd75d8af1cdfc}{GetOmega}}() \textcolor{keyword}{const};}
\DoxyCodeLine{415 }
\DoxyCodeLine{423   \textcolor{keywordtype}{float} \mbox{\hyperlink{classcontrol_1_1ServoMotor_a9e68a9777cb9686eb8c7d1c2f9980c9b}{GetOmegaDelta}}(\textcolor{keyword}{const} \textcolor{keywordtype}{float} target) \textcolor{keyword}{const};}
\DoxyCodeLine{424 }
\DoxyCodeLine{431   \textcolor{keywordtype}{void} \mbox{\hyperlink{classcontrol_1_1ServoMotor_a28ad384bb271e5043fa922eb8df36779}{UpdateData}}(\textcolor{keyword}{const} uint8\_t data[]);}
\DoxyCodeLine{432 }
\DoxyCodeLine{433  \textcolor{keyword}{private}:}
\DoxyCodeLine{434   \textcolor{comment}{// refer to servo\_t for details}}
\DoxyCodeLine{435   \mbox{\hyperlink{classcontrol_1_1MotorCANBase}{MotorCANBase}}* motor\_;}
\DoxyCodeLine{436   servo\_mode\_t mode\_;}
\DoxyCodeLine{437   \textcolor{keywordtype}{float} speed\_;}
\DoxyCodeLine{438   \textcolor{keywordtype}{float} transmission\_ratio\_;}
\DoxyCodeLine{439   \textcolor{keywordtype}{float} proximity\_;}
\DoxyCodeLine{440 }
\DoxyCodeLine{441   \textcolor{comment}{// angle control}}
\DoxyCodeLine{442   \textcolor{keywordtype}{bool} hold\_;          \textcolor{comment}{/* true if motor is holding now, otherwise moving now                      */}}
\DoxyCodeLine{443   \textcolor{keywordtype}{float} target\_;       \textcolor{comment}{/* desired target angle, range between [0, 2PI] in [rad]                   */}}
\DoxyCodeLine{444   \textcolor{keywordtype}{float} align\_angle\_;  \textcolor{comment}{/* motor angle when a instance of this class is created with that motor    */}}
\DoxyCodeLine{445   \textcolor{keywordtype}{float} motor\_angle\_;  \textcolor{comment}{/* current motor angle in [rad], with align\_angle subtracted               */}}
\DoxyCodeLine{446   \textcolor{keywordtype}{float} offset\_angle\_; \textcolor{comment}{/* cumulative offset angle of motor shaft, range between [0, 2PI] in [rad] */}}
\DoxyCodeLine{447   \textcolor{keywordtype}{float} servo\_angle\_;  \textcolor{comment}{/* current angle of motor shaft, range between [0, 2PI] in [rad]           */}}
\DoxyCodeLine{448   servo\_status\_t dir\_; \textcolor{comment}{/* current moving direction of motor (and motor shaft)                     */}}
\DoxyCodeLine{449 }
\DoxyCodeLine{450   \textcolor{comment}{// jam detection}}
\DoxyCodeLine{451   jam\_callback\_t jam\_callback\_; \textcolor{comment}{/* callback function that will be invoked if motor jammed             */} }
\DoxyCodeLine{452   \textcolor{keywordtype}{int} detect\_head\_;             \textcolor{comment}{/* circular buffer current head                                       */}}
\DoxyCodeLine{453   \textcolor{keywordtype}{int} detect\_period\_;           \textcolor{comment}{/* circular buffer length                                             */}}
\DoxyCodeLine{454   \textcolor{keywordtype}{int} detect\_total\_;            \textcolor{comment}{/* rolling sum of motor inputs                                        */}}
\DoxyCodeLine{455   \textcolor{keywordtype}{int} jam\_threshold\_;           \textcolor{comment}{/* threshold for rolling sum for the motor to be considered as jammed */}}
\DoxyCodeLine{456   int16\_t* detect\_buf\_;         \textcolor{comment}{/* circular buffer                                                    */}}
\DoxyCodeLine{457 }
\DoxyCodeLine{458   \textcolor{comment}{// pid controllers}}
\DoxyCodeLine{459   \mbox{\hyperlink{classcontrol_1_1PIDController}{PIDController}} move\_pid\_; \textcolor{comment}{/* pid for motor when it is in moving state  */}}
\DoxyCodeLine{460   \mbox{\hyperlink{classcontrol_1_1PIDController}{PIDController}} hold\_pid\_; \textcolor{comment}{/* pid for motor when it is in holding state */}}
\DoxyCodeLine{461 }
\DoxyCodeLine{462   \textcolor{comment}{// edge detectors}}
\DoxyCodeLine{463   \mbox{\hyperlink{classFloatEdgeDetector}{FloatEdgeDetector}}* wrap\_detector\_; \textcolor{comment}{/* detect motor motion across encoder boarder               */}}
\DoxyCodeLine{464   \mbox{\hyperlink{classBoolEdgeDetector}{BoolEdgeDetector}}* hold\_detector\_;  \textcolor{comment}{/* detect motor is in mode toggling, reset pid accordingly  */}}
\DoxyCodeLine{465   \mbox{\hyperlink{classBoolEdgeDetector}{BoolEdgeDetector}}* jam\_detector\_;   \textcolor{comment}{/* detect motor jam toggling, call jam callback accordingly */}}
\DoxyCodeLine{466 }
\DoxyCodeLine{471   \textcolor{keywordtype}{void} NearestModeSetDir\_();}
\DoxyCodeLine{472 }
\DoxyCodeLine{478   \textcolor{keywordtype}{void} SetDirUsingMode\_(servo\_mode\_t mode);}
\DoxyCodeLine{479   }
\DoxyCodeLine{480 \};}
\DoxyCodeLine{481 }
\DoxyCodeLine{482 \} \textcolor{comment}{/* namespace control */}}

\end{DoxyCode}
